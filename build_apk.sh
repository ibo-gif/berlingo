#!/bin/bash

# ğŸ¯ Berlingo APK Build Script
# Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ÑĞ±Ğ¾Ñ€ĞºĞ¸ APK Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Berlingo

set -e  # Exit on error

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  ğŸ“ Berlingo - APK Build Script       â•‘"
echo "â•‘  ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ±Ğ¾Ñ€ĞºĞ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ    â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Flutter
if ! command -v flutter &> /dev/null; then
    echo "âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: Flutter Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ² PATH"
    echo "   Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Flutter Ñ https://flutter.dev"
    exit 1
fi

echo "âœ“ Flutter Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: $(flutter --version)"
echo ""

# ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğ² Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
cd "$(dirname "$0")"
echo "ğŸ“ Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ Ğ²: $(pwd)"
echo ""

# ĞÑ‡Ğ¸ÑÑ‚ĞºĞ°
echo "ğŸ§¹ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°..."
flutter clean

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
echo "ğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹..."
flutter pub get

# Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° APK
echo ""
echo "ğŸ”¨ Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Release APK..."
echo "   Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ½ÑÑ‚ÑŒ 2-5 Ğ¼Ğ¸Ğ½ÑƒÑ‚..."
echo ""

start_time=$(date +%s)

flutter build apk --release

end_time=$(date +%s)
duration=$((end_time - start_time))

echo ""
echo "âœ… Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ° Ğ·Ğ° $duration ÑĞµĞºÑƒĞ½Ğ´!"
echo ""

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
if [ -f "build/app/outputs/flutter-apk/app-release.apk" ]; then
    apk_size=$(du -h "build/app/outputs/flutter-apk/app-release.apk" | cut -f1)
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘ âœ… Berlingo.apk ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ±Ñ€Ğ°Ğ½!      â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "ğŸ“± Ğ¤Ğ°Ğ¹Ğ»: build/app/outputs/flutter-apk/app-release.apk"
    echo "ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€: $apk_size"
    echo ""
    echo "ğŸš€ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ½Ğ° ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾:"
    echo "   adb install build/app/outputs/flutter-apk/app-release.apk"
    echo ""
    echo "ğŸ’¡ Ğ˜Ğ»Ğ¸ ÑĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ APK Ğ½Ğ° Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ"
else
    echo "âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: APK Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½!"
    echo "   ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ²Ñ‹ÑˆĞµ"
    exit 1
fi

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ“ Berlingo Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ!"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
